language: rust


addons:
  apt:
    packages:
    # needed for amethyst.
    - libasound2-dev
    # not sure if these are actually needed. something failed though.
    - pkg-config
    - libssl-dev
    - cmake
    - libfreetype6-dev
    - libexpat1-dev
    - libxcb-composite0-dev
    - libx11-xcb-dev


rust:
  - stable
  - beta
  - nightly


matrix:
  allow_failures:
    - rust: nightly
  fast_finish: true


# Add clippy
before_script:
  - rustup component add clippy



# check, clippy, build, test
script:
    # - cargo check --verbose
    # - cargo build --verbose
    # - cargo clippy -- -D warnings
    # - cargo test --verbose --features empty
  - cargo check --all --no-default-features --features empty
  - cargo clippy -- -D warnings
  - cargo build --all --no-default-features --features empty
  - cargo test  --all --no-default-features --features empty


    # If we're building a tag, then publish to crates.io.
    # - if [ ! -z "$TRAVIS_TAG" ]; then cargo publish --token $CRATES_TOKEN; fi
    #
    # env:
    #   global:
    #     secure: <sth>


# from: https://github.com/japaric/trust/blob/master/.travis.yml
# deploy:
#   # TODO update `api_key.secure`
#   # - Create a `public_repo` GitHub token. Go to: https://github.com/settings/tokens/new
#   # - Encrypt it: `travis encrypt 0123456789012345678901234567890123456789
#   # - Paste the output down here
#   api_key:
#     secure: <sth>
#   file_glob: true
#   file: $CRATE_NAME-$TRAVIS_TAG-$TARGET.*
#   on:
#     # TODO Here you can pick which targets will generate binary releases
#     # In this example, there are some targets that are tested using the stable
#     # and nightly channels. This condition makes sure there is only one release
#     # for such targets and that's generated using the stable channel
#     condition: $TRAVIS_RUST_VERSION = stable
#     tags: true
#   provider: releases
#   skip_cleanup: true




cache: cargo
before_cache:
  # Travis can't cache files that are not readable by "others"
  - chmod -R a+r $HOME/.cargo


branches:
  only:
    # release tags
    - /^v\d+\.\d+\.\d+.*$/
    - master


notifications:
  email:
      # recipients:
      #     - <e-mail-address>
    on_success: change # never
    on_failure: always


